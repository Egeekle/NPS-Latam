name: NPS Latam CI/CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10"]

    steps:
    - uses: actions/checkout@v3
    
    - name: Install uv
      uses: astral-sh/setup-uv@v2

    - name: Set up Python ${{ matrix.python-version }}
      run: uv python install ${{ matrix.python-version }}

    - name: Install dependencies
      run: uv sync --all-extras --dev

    - name: Run Tests
      # Assuming we had tests in a tests/ folder. 
      # For now, just checking if main modules import correctly as a smoke test
      run: |
        uv run python -c "import src.nps_latam.api; print('API module ok')"
        uv run python -c "import src.nps_latam.chatbot; print('Chatbot module ok')"

  docker-build:
    needs: test
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker Image
      run: docker build . -t nps-latam:latest
      
    # Here you would typically push to a registry like ECR, DockerHub, or GCR
    # - name: Push Docker Image
    #   run: ...
